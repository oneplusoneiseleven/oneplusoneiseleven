<script>
  let money = 0;
  let tape = 0;
  let tapeMaterial = 500;
  let tapePrice = 1.00;

  let baseDemand = 2; // 200%
  let referencePrice = 1.00;
  let publicDemand = 2;

  let materialCost = 100;
  let autoMakers = 0;
  let autoMakerBaseCost = 20;
  let autoMakerCost = autoMakerBaseCost;

  const stats = {
    money: document.getElementById('money'),
    tape: document.getElementById('tape'),
    material: document.getElementById('material'),
    tapePrice: document.getElementById('tapePrice'),
    demand: document.getElementById('demand'),
    matCost: document.getElementById('matCost'),
    autoMakers: document.getElementById('autoMakers'),
    autoMakerCost: document.getElementById('autoMakerCost')
  };

  function updateUI() {
    stats.money.textContent = money.toFixed(2);
    stats.tape.textContent = tape;
    stats.material.textContent = tapeMaterial;
    stats.tapePrice.textContent = tapePrice.toFixed(2);
    stats.demand.textContent = Math.round(publicDemand * 100) + '%';
    stats.matCost.textContent = Math.round(materialCost);
    stats.autoMakers.textContent = autoMakers;
    stats.autoMakerCost.textContent = Math.round(autoMakerCost);
  }

  function calculateDemand() {
    publicDemand = Math.max(0.01, baseDemand * (referencePrice / tapePrice));
  }

  function makeTape() {
    if (tapeMaterial > 0) {
      tapeMaterial--;
      tape++;
      updateUI();
    }
  }

  function buyMaterial() {
    if (money >= materialCost) {
      money -= materialCost;
      tapeMaterial += 500; // updated for your UI
      updateUI();
    }
  }

  function setPrice(value) {
    let price = parseFloat(value);
    if (!isNaN(price) && price >= 0.01) {
      tapePrice = price;
      calculateDemand();
      updateUI();
    }
  }

  function buyUpgrade(type) {
    if (type === 'demand' && money >= 25) {
      baseDemand *= 1.10;
      money -= 25;
    } else if (type === 'material' && money >= 40) {
      materialCost *= 0.90;
      money -= 40;
    }
    calculateDemand();
    updateUI();
  }

  function buyAutoMaker() {
    if (money >= autoMakerCost) {
      money -= autoMakerCost;
      autoMakers++;
      autoMakerCost *= 1.10;
      updateUI();
    }
  }

  function autoMakeTapes() {
    for (let i = 0; i < autoMakers; i++) {
      if (tapeMaterial > 0) {
        tapeMaterial--;
        tape++;
      }
    }
    updateUI();
  }

  function trySellTape() {
    let demand = publicDemand;
    let guaranteedSales = Math.floor(demand);
    let fractionalSales = demand - guaranteedSales;
    let sales = 0;

    // Base guaranteed sales
    for (let i = 0; i < guaranteedSales; i++) {
      if (tape > 0) {
        tape--;
        money += tapePrice;
        sales++;
      } else {
        break;
      }
    }

    // Fractional cascading chance
    let chainChance = 0.5;
    while (Math.random() < chainChance && tape > 0) {
      tape--;
      money += tapePrice;
      sales++;
      chainChance /= 2; // halve chance each step
    }

    updateUI();
  }

  // Start game loop
  calculateDemand();
  updateUI();
  setInterval(trySellTape, 1000);     // Selling loop
  setInterval(autoMakeTapes, 1000);   // Auto tape production loop
</script>
